# Story 1.4: Configure VS Code for Debugging

<!-- Powered by BMAD™ Core -->

## Status

**Ready for Review**

## Story

**As a** developer,
**I want** VS Code configured with launch and task configurations,
**so that** I can debug the WinUI3 application with F5 and run tests easily.

## Acceptance Criteria

1. `.vscode/launch.json` exists with launch configuration for WinUI3 app:
   - Type: `coreclr`
   - Program path points to built executable
   - Pre-launch task configured to build project
2. `.vscode/tasks.json` exists with tasks:
   - Build task (`dotnet build`)
   - Test task (`dotnet test`)
   - Run task (`dotnet run`)
3. C# Dev Kit extension listed in `.vscode/extensions.json` as recommended
4. Developer can press F5 in VS Code and application launches with debugger attached
5. Breakpoints set in `App.xaml.cs` are hit during debugging
6. Test task runs from VS Code Task Runner and displays results

## Tasks / Subtasks

- [x] Create `.vscode` directory structure (AC: 1, 2, 3)
  - [x] Create `.vscode/` folder in repository root if not exists
  - [x] Verify folder is tracked by Git (not in .gitignore)

- [x] Create launch configuration (AC: 1, 4, 5)
  - [x] Create `.vscode/launch.json` file
  - [x] Configure `coreclr` launch type for WinUI3 debugging
  - [x] Set `program` path to `${workspaceFolder}/src/UsbDeviceInspector/bin/x64/Debug/net8.0-windows10.0.19041.0/UsbDeviceInspector.exe`
  - [x] Configure `preLaunchTask` to reference build task
  - [x] Set `cwd` to project directory
  - [x] Enable `console: internalConsole` for debug output

- [x] Create tasks configuration (AC: 2, 6)
  - [x] Create `.vscode/tasks.json` file
  - [x] Add "build" task with command `dotnet build src/UsbDeviceInspector/UsbDeviceInspector.csproj -p:Platform=x64`
  - [x] Add "test" task with command `dotnet test -p:Platform=x64`
  - [x] Add "run" task with command `dotnet run --project src/UsbDeviceInspector/UsbDeviceInspector.csproj`
  - [x] Set appropriate `problemMatcher` for .NET builds (`$msCompile`)
  - [x] Configure build task as default build task (`"group": { "kind": "build", "isDefault": true }`)

- [x] Create extensions recommendations (AC: 3)
  - [x] Create `.vscode/extensions.json` file
  - [x] Add `ms-dotnettools.csharp` (C# extension)
  - [x] Add `ms-dotnettools.csdevkit` (C# Dev Kit)
  - [x] Add `eamodio.gitlens` (GitLens for Git history)

- [x] Verify F5 debugging workflow (AC: 4, 5)
  - [x] Open VS Code in workspace
  - [x] Press F5 to launch debugger
  - [x] Verify build task runs first
  - [x] Verify application window appears
  - [x] Set breakpoint in `App.xaml.cs` (e.g., in `OnLaunched` method)
  - [x] Restart debugging and verify breakpoint is hit

- [x] Verify test task execution (AC: 6)
  - [x] Open Command Palette (Ctrl+Shift+P)
  - [x] Run "Tasks: Run Task" and select "test"
  - [x] Verify xUnit tests execute and results display in Terminal

## Dev Notes

### Previous Story Insights

**Source:** [Story 1.2 and 1.3 Dev Agent Records]

From Story 1.2:
- Main project: `src/UsbDeviceInspector/UsbDeviceInspector.csproj`
- Target framework: `net8.0-windows10.0.19041.0`
- Platform: x64 (WinUI3 requires explicit platform, not AnyCPU)
- Windows App SDK 1.5.240802000 installed
- **Important:** Unpackaged WinUI3 apps require Windows App Runtime installation for execution

From Story 1.3:
- Test project: `src/UsbDeviceInspector.Tests/UsbDeviceInspector.Tests.csproj`
- Test command requires platform flag: `dotnet test -p:Platform=x64`
- Solution uses x64/x86 platform configurations (AnyCPU removed for WinUI3 compatibility)

### VS Code Configuration Files

**Source:** [architecture/source-tree.md]

```
.vscode/
├── launch.json    # VS Code debugging configuration
├── tasks.json     # Build/test task definitions
└── settings.json  # Workspace settings (C# formatting, etc.) - optional for this story
```

**Note:** `extensions.json` is also a standard VS Code configuration file for recommending extensions to team members.

### Development Tools Specification

**Source:** [architecture/tech-stack.md]

| Tool | Version | Purpose |
|------|---------|---------|
| VS Code + C# Dev Kit | 1.0+ | Primary IDE - lightweight development environment, excellent Git integration, XAML syntax highlighting, .NET CLI integration |
| xUnit Visual Studio Test Platform | 2.5.6 | Enables Test Explorer UI in VS Code, provides debugging integration, required for C# Dev Kit test discovery |

### WinUI3 Debugging Requirements

**Source:** [architecture/tech-stack.md, architecture/coding-standards.md]

WinUI3 debugging specifics:
- Must use `coreclr` debug type (not `clr` or `dotnet`)
- Executable path includes platform in path: `bin/x64/Debug/net8.0-windows10.0.19041.0/`
- Pre-launch build must specify platform: `-p:Platform=x64`
- Application requires Windows App Runtime to be installed on the system

### Launch Configuration Template

Based on project structure, the launch configuration should follow this pattern:

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Launch UsbDeviceInspector",
      "type": "coreclr",
      "request": "launch",
      "preLaunchTask": "build",
      "program": "${workspaceFolder}/src/UsbDeviceInspector/bin/x64/Debug/net8.0-windows10.0.19041.0/UsbDeviceInspector.exe",
      "args": [],
      "cwd": "${workspaceFolder}/src/UsbDeviceInspector",
      "console": "internalConsole",
      "stopAtEntry": false
    }
  ]
}
```

### Tasks Configuration Template

```json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "build",
      "command": "dotnet",
      "type": "process",
      "args": [
        "build",
        "${workspaceFolder}/src/UsbDeviceInspector/UsbDeviceInspector.csproj",
        "-p:Platform=x64",
        "/property:GenerateFullPaths=true",
        "/consoleloggerparameters:NoSummary"
      ],
      "problemMatcher": "$msCompile",
      "group": {
        "kind": "build",
        "isDefault": true
      }
    },
    {
      "label": "test",
      "command": "dotnet",
      "type": "process",
      "args": [
        "test",
        "${workspaceFolder}/UsbDeviceInspector.sln",
        "-p:Platform=x64"
      ],
      "problemMatcher": "$msCompile",
      "group": "test"
    },
    {
      "label": "run",
      "command": "dotnet",
      "type": "process",
      "args": [
        "run",
        "--project",
        "${workspaceFolder}/src/UsbDeviceInspector/UsbDeviceInspector.csproj"
      ],
      "problemMatcher": "$msCompile"
    }
  ]
}
```

### Extensions Recommendations Template

```json
{
  "recommendations": [
    "ms-dotnettools.csharp",
    "ms-dotnettools.csdevkit",
    "eamodio.gitlens"
  ]
}
```

### File Locations for This Story

**Story 1.4 Creates:**
- `/.vscode/launch.json` - VS Code debugging configuration
- `/.vscode/tasks.json` - Build/test task definitions
- `/.vscode/extensions.json` - Recommended extensions list

**Story 1.4 Modifies:**
- None

**Story 1.4 Does NOT Create:**
- `/.vscode/settings.json` - Workspace settings (optional, can be added later)

### Testing

**Source:** [architecture/test-strategy-and-standards.md]

**Testing Requirements for Story 1.4:**

This story establishes VS Code configuration infrastructure. Verification is manual:
1. F5 launches the application with debugger attached
2. Breakpoints in `App.xaml.cs` are hit when debugger runs
3. Test task (`Tasks: Run Task` > "test") executes xUnit tests and shows results
4. Build task completes without errors

**No automated tests are required for this story** - it configures tooling, not application code.

### Troubleshooting Notes

If F5 debugging fails:
- Verify Windows App Runtime is installed (`winget install Microsoft.WindowsAppRuntime.1.5`)
- Ensure platform is x64 in build task (WinUI3 doesn't support AnyCPU)
- Check that executable path matches actual build output path
- Verify C# Dev Kit extension is installed and activated

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-15 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2026-01-15 | 1.1 | Implementation complete | James (Dev Agent) |
| 2026-01-15 | 1.2 | Fixed runtime issue - upgraded to Windows App SDK 1.8, added WindowsPackageType=None | James (Dev Agent) |

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### File List

**Created:**
- `.vscode/launch.json` - VS Code debugging configuration with coreclr launch type for WinUI3
- `.vscode/tasks.json` - Build, test, and run task definitions with x64 platform support
- `.vscode/extensions.json` - Recommended extensions (C#, C# Dev Kit, GitLens)

**Modified:**
- `src/UsbDeviceInspector/UsbDeviceInspector.csproj` - Added `WindowsPackageType=None` for unpackaged deployment, upgraded Windows App SDK from 1.5 to 1.8.250907003, updated BuildTools to 10.0.26100.4654

**Deleted:**
- None

### Completion Notes

1. All three VS Code configuration files created successfully following the templates in Dev Notes
2. Build task verified - `dotnet build` with `-p:Platform=x64` completes with 0 errors, 0 warnings
3. Test task verified - `dotnet test` with `-p:Platform=x64` runs 1 test, all passing
4. Executable confirmed at expected path: `src/UsbDeviceInspector/bin/x64/Debug/net8.0-windows10.0.19041.0/UsbDeviceInspector.exe`
5. The `.gitignore` only excludes `.vscode/settings.json`, so all created files will be tracked by Git
6. No automated tests required per story requirements - this is tooling configuration only
7. F5 debugging workflow and test task execution ready for manual verification by user

### Debug Log References

**Runtime Issue Resolved:** Initial F5 debugging failed with `DllNotFoundException: Unable to load DLL 'Microsoft.ui.xaml.dll'`. Fixed by:
1. Adding `<WindowsPackageType>None</WindowsPackageType>` to .csproj for unpackaged WinUI3 deployment
2. Upgrading Windows App SDK from 1.5 to 1.8.250907003 to match installed runtime
3. Updating Microsoft.Windows.SDK.BuildTools to 10.0.26100.4654 (required by SDK 1.8)

### Story DoD Checklist

1. **Requirements Met:**
   - [x] All functional requirements specified in the story are implemented.
   - [x] All acceptance criteria defined in the story are met.

2. **Coding Standards & Project Structure:**
   - [x] All new/modified code strictly adheres to `Operational Guidelines`.
   - [x] All new/modified code aligns with `Project Structure` (file locations, naming, etc.).
   - [x] Adherence to `Tech Stack` for technologies/versions used.
   - [N/A] Adherence to `Api Reference` and `Data Models` - no API/data model changes.
   - [N/A] Basic security best practices - configuration files only, no executable code.
   - [N/A] No new linter errors or warnings introduced - JSON config files only.
   - [N/A] Code is well-commented - JSON config files are self-documenting.

3. **Testing:**
   - [N/A] Unit tests - no automated tests required per story spec (tooling config only).
   - [N/A] Integration tests - no automated tests required per story spec.
   - [x] All tests pass successfully - existing test suite passes (1 test).
   - [N/A] Test coverage - no new code requiring coverage.

4. **Functionality & Verification:**
   - [x] Functionality has been manually verified (build and test commands execute successfully).
   - [N/A] Edge cases - configuration files follow standard VS Code JSON schema.

5. **Story Administration:**
   - [x] All tasks within the story file are marked as complete.
   - [x] Clarifications documented - none required, templates were clear.
   - [x] Story wrap up section completed with notes and changelog.

6. **Dependencies, Build & Configuration:**
   - [x] Project builds successfully without errors.
   - [x] Project linting passes (0 warnings).
   - [N/A] No new dependencies added.
   - [N/A] No new environment variables or configurations introduced.

7. **Documentation:**
   - [N/A] Inline code documentation - JSON config files only.
   - [N/A] User-facing documentation - tooling config, not user features.
   - [N/A] Technical documentation - no architectural changes.

**Final Confirmation:**
- [x] I, the Developer Agent, confirm that all applicable items above have been addressed.

**Note:** AC 4, 5, and 6 were successfully verified by user - F5 debugging works, breakpoints are hit, and test task runs correctly.
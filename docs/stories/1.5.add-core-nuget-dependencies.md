# Story 1.5: Add Core NuGet Dependencies

<!-- Powered by BMAD™ Core -->

## Status

**Done**

## Story

**As a** developer,
**I want** CommunityToolkit.Mvvm and other foundational dependencies installed,
**so that** I can implement MVVM pattern and other architectural requirements.

## Acceptance Criteria

1. CommunityToolkit.Mvvm (version 8.0+) added to UsbDeviceInspector project
2. Microsoft.WindowsAppSDK (version 1.5+) verified in project (should be from template)
3. All dependencies restored via `dotnet restore`
4. Project builds successfully with all dependencies
5. No dependency version conflicts or warnings in build output

## Tasks / Subtasks

- [x] Add CommunityToolkit.Mvvm NuGet package (AC: 1, 3, 4, 5)
  - [x] Run `dotnet add src/UsbDeviceInspector/UsbDeviceInspector.csproj package CommunityToolkit.Mvvm --version 8.2.2`
  - [x] Verify package appears in `.csproj` file with correct version

- [x] Add Microsoft.Extensions.DependencyInjection NuGet package (AC: 3, 4, 5)
  - [x] Run `dotnet add src/UsbDeviceInspector/UsbDeviceInspector.csproj package Microsoft.Extensions.DependencyInjection --version 8.0.0`
  - [x] Verify package appears in `.csproj` file with correct version

- [x] Verify Microsoft.WindowsAppSDK version (AC: 2)
  - [x] Confirm current version 1.8.250907003 in `.csproj` (already exceeds 1.5+ requirement)
  - [x] Document verification in completion notes

- [x] Restore and build verification (AC: 3, 4, 5)
  - [x] Run `dotnet restore UsbDeviceInspector.sln`
  - [x] Run `dotnet build UsbDeviceInspector.sln -p:Platform=x64`
  - [x] Verify build completes with 0 errors, 0 warnings
  - [x] Verify no dependency version conflict warnings in output

- [x] Run existing tests to ensure no regressions (AC: 4)
  - [x] Run `dotnet test -p:Platform=x64`
  - [x] Verify all tests pass (currently 1 test)

## Dev Notes

### Previous Story Insights

**Source:** [Story 1.4 Dev Agent Record]

- Windows App SDK upgraded to **1.8.250907003** (exceeds AC2 requirement of 1.5+)
- Microsoft.Windows.SDK.BuildTools is **10.0.26100.4654**
- Platform must be **x64** for all build/test commands (WinUI3 doesn't support AnyCPU)
- `<WindowsPackageType>None</WindowsPackageType>` enables unpackaged deployment
- Build command: `dotnet build -p:Platform=x64`
- Test command: `dotnet test -p:Platform=x64`

### NuGet Package Specifications

**Source:** [architecture/tech-stack.md]

| Package | Version | Purpose |
|---------|---------|---------|
| CommunityToolkit.Mvvm | 8.2.2 | MVVM pattern implementation - provides ObservableObject, RelayCommand, source generators to reduce boilerplate |
| Microsoft.Extensions.DependencyInjection | 8.0.0 | IoC container - standard .NET DI container, constructor injection support, integrates with WinUI3 App.xaml.cs |
| Microsoft.WindowsAppSDK | 1.8.250907003 | Already installed - WinUI3 controls, Fluent Design, Windows.Devices.Enumeration API |

### MVVM Toolkit Usage

**Source:** [architecture/coding-standards.md]

Key patterns enabled by CommunityToolkit.Mvvm:
- `[ObservableProperty]` attribute - auto-generates property change notifications
- `[RelayCommand]` attribute - auto-generates ICommand implementations
- `ObservableObject` base class - provides INotifyPropertyChanged implementation
- `AsyncRelayCommand` - for async command handlers (required for Windows API calls)

**Critical Rule:** ViewModel properties bound to XAML MUST use `[ObservableProperty]` attribute. Never manually call `OnPropertyChanged()` for attributed properties.

### Dependency Injection Setup

**Source:** [architecture/coding-standards.md]

- Services MUST be injected via constructor parameters
- Service interfaces defined in `Services/Interfaces/` directory
- DI container configured in `App.xaml.cs`
- Example registration pattern (for future stories):
  ```csharp
  services.AddSingleton<IDeviceEnumerationService, DeviceEnumerationService>();
  ```

### File Locations

**Source:** [architecture/source-tree.md]

**Story 1.5 Modifies:**
- `src/UsbDeviceInspector/UsbDeviceInspector.csproj` - Add NuGet package references

**Story 1.5 Does NOT Create:**
- No new files - this story only adds package references

### Current .csproj State

The project file currently contains:
```xml
<ItemGroup>
  <PackageReference Include="Microsoft.WindowsAppSDK" Version="1.8.250907003" />
  <PackageReference Include="Microsoft.Windows.SDK.BuildTools" Version="10.0.26100.4654" />
</ItemGroup>
```

After Story 1.5, it should contain:
```xml
<ItemGroup>
  <PackageReference Include="CommunityToolkit.Mvvm" Version="8.2.2" />
  <PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="8.0.0" />
  <PackageReference Include="Microsoft.WindowsAppSDK" Version="1.8.250907003" />
  <PackageReference Include="Microsoft.Windows.SDK.BuildTools" Version="10.0.26100.4654" />
</ItemGroup>
```

### Testing

**Source:** [architecture/test-strategy-and-standards.md]

**Testing Requirements for Story 1.5:**

This story adds NuGet dependencies only. No new code is written, so no new tests are required.

**Verification is via build process:**
1. `dotnet restore` completes without errors
2. `dotnet build -p:Platform=x64` completes with 0 errors, 0 warnings
3. `dotnet test -p:Platform=x64` passes (existing tests still work)
4. No dependency conflict warnings in build output

**No automated tests are required for this story** - it adds dependencies, not application code.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-16 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2026-01-16 | 1.1 | Implementation complete | James (Dev Agent) |

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### File List

**Modified:**
- `src/UsbDeviceInspector/UsbDeviceInspector.csproj` - Added CommunityToolkit.Mvvm 8.2.2 and Microsoft.Extensions.DependencyInjection 8.0.0 package references
- `src/UsbDeviceInspector.Tests/UsbDeviceInspector.Tests.csproj` - Updated Microsoft.WindowsAppSDK from 1.5.240802000 to 1.8.250907003 to resolve version conflict

### Completion Notes

**Packages Added:**
- CommunityToolkit.Mvvm 8.2.2 - MVVM pattern implementation with source generators
- Microsoft.Extensions.DependencyInjection 8.0.0 - Standard .NET IoC container

**WindowsAppSDK Verification:**
- Main project: 1.8.250907003 (exceeds 1.5+ requirement) ✓
- Test project: Updated from 1.5.240802000 to 1.8.250907003 to resolve NU1605 package downgrade error

**Build Results:**
- `dotnet restore` - Success
- `dotnet build -p:Platform=x64` - 0 errors, 0 warnings
- `dotnet test -p:Platform=x64` - 1/1 tests passed

**For Next Story:**
- CommunityToolkit.Mvvm is ready for use with `[ObservableProperty]` and `[RelayCommand]` attributes
- Microsoft.Extensions.DependencyInjection is ready for configuring DI in App.xaml.cs

### Debug Log References

None - no issues encountered that required debug logging.

### Story DoD Checklist

**1. Requirements Met:**
- [x] All functional requirements specified in the story are implemented.
- [x] All acceptance criteria defined in the story are met.
  - AC1: CommunityToolkit.Mvvm 8.2.2 added ✓
  - AC2: Microsoft.WindowsAppSDK 1.8.250907003 verified (exceeds 1.5+) ✓
  - AC3: Dependencies restored via `dotnet restore` ✓
  - AC4: Project builds successfully ✓
  - AC5: No dependency version conflicts in build output ✓

**2. Coding Standards & Project Structure:**
- [x] All new/modified code strictly adheres to `Operational Guidelines`.
- [x] All new/modified code aligns with `Project Structure` (file locations, naming, etc.).
- [x] Adherence to `Tech Stack` for technologies/versions used.
- [N/A] Adherence to `Api Reference` and `Data Models` - no API or data model changes.
- [N/A] Basic security best practices - no application code changes.
- [x] No new linter errors or warnings introduced.
- [N/A] Code is well-commented - no application code changes.

**3. Testing:**
- [N/A] All required unit tests - story adds dependencies only, no new tests required per story notes.
- [N/A] All required integration tests - not applicable.
- [x] All tests pass successfully (1/1 tests passed).
- [N/A] Test coverage - no new code to cover.

**4. Functionality & Verification:**
- [x] Functionality verified - packages installed and build/test successful.
- [N/A] Edge cases - not applicable to dependency installation.

**5. Story Administration:**
- [x] All tasks within the story file are marked as complete.
- [x] Clarifications documented - test project WindowsAppSDK version sync noted.
- [x] Story wrap up section completed.

**6. Dependencies, Build & Configuration:**
- [x] Project builds successfully without errors.
- [x] Project linting passes (0 warnings).
- [x] New dependencies pre-approved in story requirements.
- [x] Dependencies recorded in `.csproj` files.
- [x] No known security vulnerabilities (packages from official NuGet).
- [N/A] No new environment variables introduced.

**7. Documentation:**
- [N/A] No new public APIs or complex logic.
- [N/A] No user-facing documentation changes needed.
- [N/A] No architectural changes requiring documentation.

**Final Confirmation:**
- [x] I, the Developer Agent, confirm that all applicable items above have been addressed.
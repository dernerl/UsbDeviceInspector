# Story 1.6: Implement GitHub Actions CI/CD Pipeline

<!-- Powered by BMAD™ Core -->

## Status

**Approved**

## Story

**As a** developer,
**I want** a GitHub Actions workflow that builds and tests the solution automatically,
**so that** every push and pull request is validated before merging.

## Acceptance Criteria

1. Workflow file exists: `.github/workflows/build.yml`
2. Workflow triggers on:
   - Push to `main` branch
   - Pull requests targeting `main`
3. Workflow steps include:
   - Checkout repository
   - Setup .NET 8.0 SDK
   - Install Windows App SDK templates
   - Restore dependencies
   - Build solution
   - Run tests
4. Workflow runs on `windows-latest` runner (required for WinUI3)
5. Build artifacts created (executable and DLLs) and uploaded as workflow artifacts
6. Workflow completes successfully on test push to main branch
7. Badge added to README.md showing build status

## Tasks / Subtasks

- [x] Create GitHub Actions workflow file (AC: 1, 2, 3, 4)
  - [x] Create `.github/workflows/build.yml` file
  - [x] Configure trigger events: `push` to `main` and `pull_request` targeting `main`
  - [x] Set runner to `windows-latest`
  - [x] Add step: `actions/checkout@v4` to checkout repository
  - [x] Add step: `actions/setup-dotnet@v4` with `dotnet-version: '8.0.x'`
  - [x] Add step: Install Windows App SDK templates via `dotnet new install Microsoft.WindowsAppSDK.Templates`
  - [x] Add step: `dotnet restore UsbDeviceInspector.sln`
  - [x] Add step: `dotnet build UsbDeviceInspector.sln -c Release -p:Platform=x64 --no-restore`
  - [x] Add step: `dotnet test UsbDeviceInspector.sln -c Release -p:Platform=x64 --no-build --verbosity normal`

- [x] Configure build artifact upload (AC: 5)
  - [x] Add step: `actions/upload-artifact@v4` to upload build artifacts
  - [x] Configure artifact path to include executable and DLLs from `src/UsbDeviceInspector/bin/x64/Release/net8.0-windows10.0.19041.0/`
  - [x] Set artifact name to `UsbDeviceInspector-win-x64`
  - [x] Set retention-days to 30

- [ ] Validate workflow execution (AC: 6)
  - [ ] Commit and push workflow file to repository
  - [ ] Verify workflow triggers and runs successfully
  - [ ] Verify all steps complete without errors
  - [ ] Verify artifacts are uploaded and downloadable

- [x] Add build status badge to README.md (AC: 7)
  - [x] Add GitHub Actions badge to top of README.md
  - [x] Badge format: `![Build Status](https://github.com/{owner}/{repo}/actions/workflows/build.yml/badge.svg)`
  - [ ] Verify badge displays correctly and links to Actions tab

## Dev Notes

### Previous Story Insights

**Source:** [Story 1.5 Dev Agent Record]

- **CRITICAL:** Platform must be `x64` for all build/test commands (WinUI3 doesn't support AnyCPU)
- Build command: `dotnet build -p:Platform=x64`
- Test command: `dotnet test -p:Platform=x64`
- Windows App SDK version: **1.8.250907003**
- Both main project and test project have matching WindowsAppSDK versions (resolved version conflict in Story 1.5)
- Current build produces **0 errors, 0 warnings**
- Current tests: **1/1 passing**

### GitHub Actions Configuration

**Source:** [architecture/tech-stack.md#CI/CD]

| Setting | Value | Rationale |
|---------|-------|-----------|
| CI/CD Platform | GitHub Actions | Free for public repos, same CLI commands as local development |
| Runner | `windows-latest` | Required for WinUI3 - Windows App SDK only builds on Windows |
| .NET SDK | 8.0.x | Matches project target framework |

### Build Pipeline Specifications

**Source:** [architecture/infrastructure-and-deployment.md#Deployment Strategy]

**Pipeline Steps (in order):**
1. **Checkout** - Get repository source code
2. **Setup .NET SDK** - Install .NET 8.0 SDK on runner
3. **Install Templates** - Install Windows App SDK templates (required for restore)
4. **Restore** - Restore NuGet dependencies
5. **Build** - Compile with Release configuration
6. **Test** - Run xUnit test suite
7. **Upload Artifacts** - Save build output for download

**Environment Promotion Flow:**
```
Developer Branch → Pull Request → CI Build + Test → main Branch
```

### File Locations

**Source:** [architecture/source-tree.md]

**Story 1.6 Creates:**
- `.github/workflows/build.yml` - GitHub Actions CI/CD pipeline configuration

**Story 1.6 Modifies:**
- `README.md` - Add build status badge at top of file

### Workflow YAML Structure

**Source:** Best practices for GitHub Actions with .NET + WinUI3

```yaml
name: Build and Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'

    - name: Install Windows App SDK Templates
      run: dotnet new install Microsoft.WindowsAppSDK.Templates

    - name: Restore dependencies
      run: dotnet restore UsbDeviceInspector.sln

    - name: Build
      run: dotnet build UsbDeviceInspector.sln -c Release -p:Platform=x64 --no-restore

    - name: Test
      run: dotnet test UsbDeviceInspector.sln -c Release -p:Platform=x64 --no-build --verbosity normal

    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: UsbDeviceInspector-win-x64
        path: src/UsbDeviceInspector/bin/Release/net8.0-windows10.0.19041.0/win-x64/
        retention-days: 30
```

### Build Artifact Path

**Source:** [architecture/coding-standards.md]

Target framework: `net8.0-windows10.0.19041.0`

Expected Release build output path:
```
src/UsbDeviceInspector/bin/Release/net8.0-windows10.0.19041.0/win-x64/
```

Key artifacts to include:
- `UsbDeviceInspector.exe` - Main executable
- `*.dll` - All dependency DLLs
- `*.pdb` - Debug symbols (optional, useful for crash diagnostics)
- `UsbDeviceInspector.runtimeconfig.json` - Runtime configuration

### README Badge Format

**Source:** GitHub Actions documentation

Badge markdown syntax:
```markdown
![Build Status](https://github.com/{owner}/{repo}/actions/workflows/build.yml/badge.svg)
```

Place at the very top of README.md, before the title or immediately after the title.

### Testing

**Source:** [architecture/test-strategy-and-standards.md]

**Testing Requirements for Story 1.6:**

This story creates CI/CD infrastructure only. No new application code is written, so no new unit tests are required.

**Verification is via workflow execution:**
1. Workflow triggers on push to main
2. Workflow triggers on pull request to main
3. All workflow steps complete successfully
4. Build artifacts are uploaded and downloadable
5. Badge displays correct status in README.md

**CI Test Configuration (for reference in workflow):**
- Run tests with `-c Release` configuration to match build
- Use `--no-build` flag since build step already compiled
- Use `--verbosity normal` for readable test output in logs
- Platform must be `x64` (WinUI3 requirement)

**No additional automated tests are required for this story** - it creates CI configuration, not application code.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-16 | 1.0 | Initial story creation | Bob (Scrum Master) |

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### File List

| File | Action | Description |
|------|--------|-------------|
| `.github/workflows/build.yml` | Created | GitHub Actions CI/CD workflow |
| `README.md` | Modified | Added build status badge at top |

### Completion Notes

- Created GitHub Actions workflow with all required steps: checkout, .NET 8.0 setup, Windows App SDK templates, restore, build, test, artifact upload
- Corrected artifact path from story template: actual build output is `bin/x64/Release/` not `bin/Release/` (due to `-p:Platform=x64` flag)
- Badge includes clickable link to Actions tab
- Local validation: Release build succeeds with 0 errors, 0 warnings; 1/1 tests passing
- **BLOCKING:** Tasks for "Validate workflow execution" (AC: 6) require commit/push to main and verification on GitHub - these cannot be completed locally

### Debug Log References

None - no errors encountered during implementation.

### Story DoD Checklist

**1. Requirements Met:**
- [x] All functional requirements specified in the story are implemented
- [x] All acceptance criteria defined in the story are met (AC 1-5, 7 implemented; AC 6 requires push to verify)

**2. Coding Standards & Project Structure:**
- [x] All new/modified code strictly adheres to Operational Guidelines
- [x] All new/modified code aligns with Project Structure (`.github/workflows/build.yml` as specified in source-tree.md)
- [x] Adherence to Tech Stack for technologies/versions used
- [N/A] Adherence to Api Reference and Data Models (no API/data model changes)
- [x] Basic security best practices applied
- [x] No new linter errors or warnings introduced
- [x] Code is well-commented where necessary (YAML steps have descriptive names)

**3. Testing:**
- [N/A] Unit tests - story creates CI infrastructure, no application code
- [N/A] Integration tests - story creates CI infrastructure
- [x] All existing tests pass successfully (1/1 passing)
- [N/A] Test coverage - no new application code

**4. Functionality & Verification:**
- [x] Functionality manually verified locally (build succeeds, tests pass)
- [x] Edge cases considered (Platform=x64 requirement handled)

**5. Story Administration:**
- [x] All implementable tasks marked complete
- [x] Decisions documented (artifact path correction noted)
- [x] Story wrap up section completed

**6. Dependencies, Build & Configuration:**
- [x] Project builds successfully without errors
- [x] Project linting passes
- [N/A] No new dependencies added to application
- [N/A] No new environment variables introduced

**7. Documentation:**
- [x] README.md updated with build badge
- [N/A] No architectural changes requiring documentation updates

**Final Confirmation:**
- [x] I, the Developer Agent, confirm that all applicable items above have been addressed.

**Note:** Story cannot be marked "Ready for Review" until workflow is pushed and verified on GitHub (AC: 6 validation tasks).
# Story 1.3: Create xUnit Test Project

<!-- Powered by BMAD™ Core -->

## Status

**Done**

## Story

**As a** developer,
**I want** an xUnit test project with necessary testing dependencies,
**so that** I can write unit and integration tests from the beginning.

## Acceptance Criteria

1. xUnit test project created: `src/UsbDeviceInspector.Tests/UsbDeviceInspector.Tests.csproj`
2. Test project targets .NET 8.0
3. Test project includes NuGet packages:
   - xUnit (latest stable)
   - FluentAssertions (latest stable)
   - NSubstitute (latest stable)
   - xunit.runner.visualstudio (for test discovery)
4. Test project references main UsbDeviceInspector project
5. Solution file references the test project
6. Sample "hello world" test exists and passes: `dotnet test` succeeds with 1 passing test
7. Test results displayed in console output

## Tasks / Subtasks

- [x] Create xUnit test project (AC: 1, 2)
  - [x] Run `dotnet new xunit -n UsbDeviceInspector.Tests -o src/UsbDeviceInspector.Tests`
  - [x] Verify project created at `src/UsbDeviceInspector.Tests/UsbDeviceInspector.Tests.csproj`
  - [x] Confirm target framework is `net8.0` in `.csproj` file
- [x] Configure NuGet packages (AC: 3)
  - [x] Verify xUnit packages are included (should come from template)
  - [x] Add FluentAssertions package: `dotnet add src/UsbDeviceInspector.Tests package FluentAssertions`
  - [x] Add NSubstitute package: `dotnet add src/UsbDeviceInspector.Tests package NSubstitute`
  - [x] Verify xunit.runner.visualstudio is present (should come from template)
  - [x] Run `dotnet restore` to confirm all packages resolve
- [x] Add project reference to main application (AC: 4)
  - [x] Run `dotnet add src/UsbDeviceInspector.Tests reference src/UsbDeviceInspector/UsbDeviceInspector.csproj`
  - [x] Verify `<ProjectReference>` element added to test project `.csproj`
- [x] Add test project to solution (AC: 5)
  - [x] Run `dotnet sln add src/UsbDeviceInspector.Tests/UsbDeviceInspector.Tests.csproj`
  - [x] Verify solution file updated with test project reference
- [x] Create sample "hello world" test (AC: 6)
  - [x] Rename or replace default `UnitTest1.cs` with `SampleTests.cs`
  - [x] Create simple passing test using FluentAssertions syntax
  - [x] Test method name follows convention: `MethodName_Scenario_ExpectedBehavior`
- [x] Verify test execution (AC: 6, 7)
  - [x] Run `dotnet test` from repository root
  - [x] Verify 1 test discovered and passes
  - [x] Verify test results displayed in console output
- [x] Configure test project settings
  - [x] Add `<Nullable>enable</Nullable>` to match main project
  - [x] Add `<LangVersion>12.0</LangVersion>` for C# 12 features
  - [x] Verify project builds without warnings

## Dev Notes

### Previous Story Insights

**Source:** [Story 1.2 Dev Agent Record]

Story 1.2 successfully created the .NET solution and WinUI3 project:
- Solution file: `UsbDeviceInspector.sln` in repository root
- Main project: `src/UsbDeviceInspector/UsbDeviceInspector.csproj`
- Project configuration: .NET 8.0, Windows 10 SDK 10.0.19041.0, C# 12.0, nullable enabled
- Windows App SDK 1.5.240802000 installed
- Build verified successful

**Note from Story 1.2:** The WinUI3 project was manually created (official `wasdk-winui-cs` template not available via `dotnet new`). Unpackaged WinUI3 apps require Windows App Runtime installation for execution.

### Test Framework Specifications

**Source:** [architecture/tech-stack.md]

| Package | Version | Purpose |
|---------|---------|---------|
| xUnit | 2.6.6 | Test execution engine - industry standard for .NET |
| FluentAssertions | 6.12.0 | Readable test assertions with natural language syntax |
| NSubstitute | 5.1.0 | Mocking framework - simplest syntax in .NET ecosystem |
| xUnit Visual Studio Test Platform | 2.5.6 | Enables Test Explorer in VS Code, required for C# Dev Kit test discovery |

### Test Project Structure

**Source:** [architecture/source-tree.md]

```
src/UsbDeviceInspector.Tests/
├── UsbDeviceInspector.Tests.csproj  # Test project file
├── Services/                         # Service layer tests (future stories)
│   ├── DeviceParsingServiceTests.cs
│   ├── FormatServiceTests.cs
│   └── ClipboardExportServiceTests.cs
├── ViewModels/                       # ViewModel tests (future stories)
│   └── MainViewModelTests.cs
└── TestData/                         # Test fixtures and mock data (future stories)
    ├── MockDeviceInformation.cs
    └── SampleDevicePaths.cs
```

**Note:** For Story 1.3, only the project file and a sample test are created. The folder structure for `Services/`, `ViewModels/`, and `TestData/` will be created in future stories as actual tests are implemented.

### Test Naming Conventions

**Source:** [architecture/coding-standards.md#test-organization]

- **Test file naming:** `{ClassUnderTest}Tests.cs` (e.g., `MainViewModelTests.cs`)
- **Test method naming:** `MethodName_Scenario_ExpectedBehavior`
  - Example: `ParseDevices_WithMissingSerialNumber_ReturnsDeviceWithHasSerialNumberFalse`
- **Test file location:** Mirror source structure
  - `UsbDeviceInspector/Services/DeviceParsingService.cs` → `UsbDeviceInspector.Tests/Services/DeviceParsingServiceTests.cs`

### Test Pattern Requirements

**Source:** [architecture/test-strategy-and-standards.md]

- Follow AAA pattern (Arrange, Act, Assert) with clear section comments
- Use FluentAssertions `.Should()` syntax for all assertions
- Example structure:

```csharp
[Fact]
public void SampleMethod_WhenCondition_ExpectedResult()
{
    // Arrange
    var expected = true;

    // Act
    var result = true;

    // Assert
    result.Should().Be(expected);
}
```

### Project Configuration Requirements

**Source:** [architecture/coding-standards.md#core-standards]

The test project `.csproj` should include:
- `<TargetFramework>net8.0</TargetFramework>` (standard .NET 8, not Windows-specific)
- `<LangVersion>12.0</LangVersion>` - Enable C# 12 features
- `<Nullable>enable</Nullable>` - Enable nullable reference type checking
- `<ImplicitUsings>enable</ImplicitUsings>` - Standard implicit usings

**Note:** Test project targets `net8.0` (not `net8.0-windows10.0.19041.0`) because unit tests don't require Windows SDK APIs directly - they mock Windows dependencies.

### Solution Commands Reference

```bash
# Create xUnit test project
dotnet new xunit -n UsbDeviceInspector.Tests -o src/UsbDeviceInspector.Tests

# Add NuGet packages
dotnet add src/UsbDeviceInspector.Tests package FluentAssertions
dotnet add src/UsbDeviceInspector.Tests package NSubstitute

# Add project reference
dotnet add src/UsbDeviceInspector.Tests reference src/UsbDeviceInspector/UsbDeviceInspector.csproj

# Add to solution
dotnet sln add src/UsbDeviceInspector.Tests/UsbDeviceInspector.Tests.csproj

# Run tests
dotnet test
```

### File Locations for This Story

**Story 1.3 Creates:**
- `/src/UsbDeviceInspector.Tests/UsbDeviceInspector.Tests.csproj` - Test project file
- `/src/UsbDeviceInspector.Tests/SampleTests.cs` - Sample "hello world" test (replaces template's `UnitTest1.cs`)

**Story 1.3 Modifies:**
- `/UsbDeviceInspector.sln` - Add test project reference

**Story 1.3 Does NOT Create:**
- Test subdirectories (`Services/`, `ViewModels/`, `TestData/`) - created in future stories
- Actual service/ViewModel tests - created in Epic 2+
- Integration test folder - created when integration tests are needed

### Testing

**Source:** [architecture/test-strategy-and-standards.md]

**Testing Requirements for Story 1.3:**

This story establishes the test project infrastructure. The verification for this story is:
1. Test project compiles without errors
2. Sample test is discovered by test runner
3. `dotnet test` passes with 1 test

**Sample Test Implementation:**

The sample test should demonstrate:
- FluentAssertions usage (`.Should().Be()` syntax)
- Proper test method naming convention
- AAA pattern structure

```csharp
using FluentAssertions;
using Xunit;

namespace UsbDeviceInspector.Tests;

public class SampleTests
{
    [Fact]
    public void SampleTest_WhenTrue_ReturnsTrue()
    {
        // Arrange
        var expected = true;

        // Act
        var result = true;

        // Assert
        result.Should().Be(expected);
    }
}
```

**Coverage Targets (for future stories):**
- Service layer: 80%+ line coverage
- ViewModel layer: 70%+ coverage
- Overall project: 75%+ coverage excluding UI layer

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-15 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References

N/A - No debug log entries required for this infrastructure story.

### Completion Notes

- xUnit test project created using `dotnet new xunit` template
- Test project targets `net8.0-windows10.0.19041.0` (changed from `net8.0` to enable project reference compatibility with WinUI3 main project)
- NuGet packages installed:
  - xUnit 2.5.3
  - FluentAssertions 8.8.0
  - NSubstitute 5.3.0
  - xunit.runner.visualstudio 2.5.3
  - coverlet.collector 6.0.0
  - Microsoft.NET.Test.Sdk 17.8.0
  - Microsoft.WindowsAppSDK 1.5.240802000 (with ExcludeAssets="buildTransitive" to avoid VS tooling dependency)
- **Important Configuration Note:** Due to Windows App SDK transitive dependency issues with .NET 8.0 RID resolution, the test project requires:
  - `<RuntimeIdentifier>win-x64</RuntimeIdentifier>` - Fixed x64 target
  - `<UseRidGraph>true</UseRidGraph>` - Enable legacy RID graph for win10-* compatibility
  - Build command: `dotnet test -p:Platform=x64`
- Solution file updated with x64/x86 platform configurations (removed AnyCPU which is incompatible with WinUI3/Windows App SDK)
- Sample test created following AAA pattern with FluentAssertions syntax

### File List

| File | Status | Description |
|------|--------|-------------|
| `src/UsbDeviceInspector.Tests/UsbDeviceInspector.Tests.csproj` | Created | xUnit test project file with all dependencies |
| `src/UsbDeviceInspector.Tests/SampleTests.cs` | Created | Sample "hello world" test demonstrating FluentAssertions |
| `UsbDeviceInspector.sln` | Modified | Added test project reference and x64/x86 platform configurations |

## QA Results

### Review Date: 2026-01-15

### Reviewed By: Quinn (Test Architect)

### Verification Summary

| AC | Requirement | Status | Notes |
|----|-------------|--------|-------|
| 1 | xUnit test project created | PASS | Project exists at `src/UsbDeviceInspector.Tests/UsbDeviceInspector.Tests.csproj` |
| 2 | Test project targets .NET 8.0 | PASS | Targets `net8.0-windows10.0.19041.0` (adapted for WinUI3 project reference compatibility) |
| 3 | NuGet packages included | PASS | xUnit 2.5.3, FluentAssertions 8.8.0, NSubstitute 5.3.0, xunit.runner.visualstudio 2.5.3 |
| 4 | Project references main project | PASS | `<ProjectReference>` to UsbDeviceInspector.csproj verified |
| 5 | Solution file references test project | PASS | Solution includes test project with proper configuration |
| 6 | Sample test exists and passes | PASS | `SampleTest_WhenTrue_ReturnsTrue` follows AAA pattern with FluentAssertions |
| 7 | Test results displayed in console | PASS | `dotnet test -p:Platform=x64` shows results |

### Test Execution Results

```
Test Run Successful.
Total tests: 1
     Passed: 1
 Total time: 0,5943 Seconds
```

### Implementation Notes

- Test project correctly uses `net8.0-windows10.0.19041.0` instead of plain `net8.0` to enable compatibility with WinUI3 main project reference
- Required workarounds for Windows App SDK RID resolution: `<RuntimeIdentifier>win-x64</RuntimeIdentifier>` and `<UseRidGraph>true</UseRidGraph>`
- Build command `dotnet test -p:Platform=x64` required due to x64-only configuration

### Gate Status

Gate: PASS → docs/qa/gates/1.3-create-xunit-test-project.yml